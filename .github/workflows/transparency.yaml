name: Create transparency report

on:
  schedule:
    - cron: 0 */3 * * *
  workflow_dispatch:
  push:
    paths: [.github/workflows/transparency.yaml]

jobs:
  audit-pdf:
    permissions:
      id-token: write
      contents: write
      attestations: write
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - name: screenshot listing page
        uses: karol-brejna-i/webpage-screenshot-action@94dd5ca598dcb80be94d5d2c6ad87d550ebbfa48
        with:
          url: https://douglashomes.net/new-home/fernie-3-2/
          mode: wholePage
          output: fernie-3-2.png
      - name: screenshot warranty limits
        uses: karol-brejna-i/webpage-screenshot-action@94dd5ca598dcb80be94d5d2c6ad87d550ebbfa48
        with:
          url: https://anhwp.com/homeowners/owning-your-new-home/new-home-warranty/
          mode: element
          output: anhwp-new-home-warranty.png
          selector: .fusion-text-6
      - name: audit the PDF
        run: |
          curl -LO --silent https://douglashomes.net/wp-content/uploads/2024/08/Fernie-204LWC{,-{1..3}}.pdf
          sha256sum Fernie-204LWC.pdf >> $GITHUB_STEP_SUMMARY
      - uses: actions/attest-build-provenance@ef244123eb79f2f7a7e75d99086184180e6d0018 # v1.4.4
        with:
          subject-path: '.github/workflows/transparency.yaml, Fernie-*.pdf, fernie-3-2.png, anhwp-new-home-warranty.png, _posts'
      - name: Commit & Push changes
        uses: actions-js/push@5a7cbd780d82c0c937b5977586e641b2fd94acc5 # v1.5
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          message: 'updating the lanark landing listing @ 204 Langwell Common SE'
